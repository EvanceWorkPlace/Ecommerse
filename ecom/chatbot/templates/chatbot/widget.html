<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chatbot Consultation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body class="bg-light">
  <div class="container py-5">
    <h2 class="mb-4 text-center">ðŸ©º Start a Medical Consultation</h2>

    <!-- Start Consultation Form -->
    <form id="startForm" class="card p-4 mb-4">
      <h5>Patient Info</h5>
      <input type="text" class="form-control mb-2" name="full_name" placeholder="Full Name" required />
      <input type="date" class="form-control mb-2" name="date_of_birth" required />
      <select class="form-control mb-2" name="gender" required>
        <option value="">Select Gender</option>
        <option>Male</option>
        <option>Female</option>
        <option>Other</option>
      </select>

      <h5 class="mt-3">Consultation Details</h5>
      <textarea class="form-control mb-2" name="reported_illness" placeholder="Reported Illness"></textarea>
      <textarea class="form-control mb-2" name="symptoms" placeholder="Symptoms"></textarea>
      <textarea class="form-control mb-2" name="allergies" placeholder="Allergies"></textarea>
      <textarea class="form-control mb-2" name="current_medications" placeholder="Current Medications"></textarea>
      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" name="consent_given" id="consentCheck" required />
        <label class="form-check-label" for="consentCheck">I give consent for AI-based recommendation</label>
      </div>
      <button type="submit" class="btn btn-primary">Start Consultation</button>
    </form>

    <!-- Add Answers Form -->
    <form id="answersForm" class="card p-4 mb-4">
      <h5>Add More Details</h5>
      <input type="number" class="form-control mb-2" name="consultation_id" placeholder="Consultation ID" required />
      <textarea class="form-control mb-2" name="symptoms" placeholder="Updated Symptoms"></textarea>
      <textarea class="form-control mb-2" name="current_medications" placeholder="Updated Medications"></textarea>
      <button type="submit" class="btn btn-secondary">Add Answers</button>
    </form>

    <!-- Generate Recommendation -->
    <form id="recommendForm" class="card p-4 mb-4">
      <h5>Generate Recommendation</h5>
      <input type="number" class="form-control mb-2" name="consultation_id" placeholder="Consultation ID" required />
      <button type="submit" class="btn btn-success">Generate Recommendation</button>
    </form>

    <!-- Get Recommendation -->
    <form id="getRecForm" class="card p-4 mb-4">
      <h5>View Recommendation</h5>
      <input type="number" class="form-control mb-2" name="recommendation_id" placeholder="Recommendation ID" required />
      <button type="submit" class="btn btn-info">Get Recommendation</button>
    </form>

    <div id="responseBox" class="mt-4"></div>
  </div>

  <script>
    const apiBase = "http://localhost:8000"; // Update if hosted elsewhere

    function postData(url, data) {
      return fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      }).then(res => res.json());
    }

    function getData(url) {
      return fetch(url, {
        method: "GET",
        headers: { "Content-Type": "application/json" }
      }).then(res => res.json());
    }

    document.getElementById("startForm").onsubmit = async e => {
      e.preventDefault();
      const form = e.target;
      const data = {
        patient: {
          full_name: form.full_name.value,
          date_of_birth: form.date_of_birth.value,
          gender: form.gender.value
        },
        reported_illness: form.reported_illness.value,
        symptoms: form.symptoms.value,
        allergies: form.allergies.value,
        current_medications: form.current_medications.value,
        consent_given: form.consent_given.checked
      };
      const res = await postData(`${apiBase}/start/`, data);
      document.getElementById("responseBox").innerText = JSON.stringify(res, null, 2);
    };

    document.getElementById("answersForm").onsubmit = async e => {
      e.preventDefault();
      const form = e.target;
      const id = form.consultation_id.value;
      const data = {
        symptoms: form.symptoms.value,
        current_medications: form.current_medications.value
      };
      const res = await postData(`${apiBase}/consultation/${id}/answers/`, data);
      document.getElementById("responseBox").innerText = JSON.stringify(res, null, 2);
    };

    document.getElementById("recommendForm").onsubmit = async e => {
      e.preventDefault();
      const form = e.target;
      const id = form.consultation_id.value;
      const res = await postData(`${apiBase}/consultation/${id}/recommend/`, {});
      document.getElementById("responseBox").innerText = JSON.stringify(res, null, 2);
    };

    document.getElementById("getRecForm").onsubmit = async e => {
      e.preventDefault();
      const form = e.target;
      const id = form.recommendation_id.value;
      const res = await getData(`${apiBase}/recommendation/${id}/`);
      document.getElementById("responseBox").innerText = JSON.stringify(res, null, 2);
    };
  </script>
</body>
</html>
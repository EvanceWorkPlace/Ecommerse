{% extends 'base.html' %}
{% block content %}

<section class="py-5 bg-light">
  <div class="container">
    <h2 class="text-center fw-bold mb-4 text-primary">ðŸ©º Health Monitoring Widget</h2>

    <div class="card shadow-lg border-0 rounded-4 p-4">
      <form id="health-form">
        {% csrf_token %}
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label fw-semibold">Disease Type</label>
            <select name="disease" class="form-select rounded-pill">
              <option value="diabetes">Diabetes</option>
              <option value="hypertension">Hypertension</option>
              <option value="cardiac">Cardiac</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold">Blood Sugar (mg/dL)</label>
            <input type="number" name="blood_sugar" class="form-control rounded-pill">
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold">Systolic (mmHg)</label>
            <input type="number" name="systolic" class="form-control rounded-pill">
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold">Diastolic (mmHg)</label>
            <input type="number" name="diastolic" class="form-control rounded-pill">
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold">Heart Rate (bpm)</label>
            <input type="number" name="heart_rate" class="form-control rounded-pill">
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold">BMI</label>
            <input type="number" step="0.1" name="bmi" class="form-control rounded-pill">
          </div>
        </div>

        <div class="text-center mt-4">
          <button type="submit" class="btn btn-primary rounded-pill px-5 py-2">
            Analyze Health
          </button>
        </div>
      </form>
    </div>

    <div id="results" class="mt-5" style="display:none;">
      <div class="card shadow-sm border-0 rounded-4 p-4">
        <h4 class="text-success fw-bold mb-3">Results Summary</h4>
        <ul id="summary-list"></ul>

        <h4 class="text-info fw-bold mt-4">ðŸ’¬ AI Insights</h4>
        <p id="ai-feedback" class="text-secondary"></p>
      </div>
    </div>
  </div>
</section>

<script>
document.getElementById("health-form").addEventListener("submit", async (e) => {
  e.preventDefault();

  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData.entries());

  const response = await fetch("{% url 'health_analysis' %}", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });

  const result = await response.json();

  if (result.summary) {
    document.getElementById("results").style.display = "block";
    document.getElementById("summary-list").innerHTML = result.summary
      .map(item => `<li>${item}</li>`).join("");
    document.getElementById("ai-feedback").textContent = result.ai_feedback;
  }
});
</script>

<style>
  .card { background-color: #fff; border-radius: 20px; }
  button.btn-primary {
    background: linear-gradient(135deg, #007bff, #00c6ff);
    border: none;
    font-weight: 600;
  }
  button.btn-primary:hover { transform: scale(1.05); }
</style>

{% endblock %}
